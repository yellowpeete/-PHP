# Ограничение частоты запросов к серверу от пользователей

Недавно встала задача, сделать небольшую защиту от спама обращениями к API, нужно было ограничить обращения до 5 в 5 секунд.
Проект писался на битриксе, для реализации выбрал хранение IP адреса и кол-во попыток подключения в Memcache.
На мой взгляд таким подходом можно хоть и незначительно, но уменьшить время, за которое сервер отдавал данные по API.
Собственно ниже код реализации
```php
    function ifHasTimeOut($ip) {
    $timeToBlock=5; //количество запросов до блокировки
    $liveTime = 5;  //через какое время будет обновляться счетчик обращений
    $memcache = new \Memcache; 
    $memcache->addServer('localhost', 11211);
    $count = $memcache->get($ip);


    if ($count) {
        if ($count >= $timeToBlock) {
            return true;
        } else {
            $memcache->increment($ip, 1);
            return false;
        }
    } else {
        $memcache->set($ip, 1, false, $liveTime);
    }
    }
```

Используется довольно просто, оберните ваш код проверкой лайк хир
```php
if(!ifHasTimeOut($_SERVER['REMOTE_ADDR'])):
//Выполняете свой скрипт, отдаете данные API и тд
else:
// Пользователь заблокирован, можете что то сделать, можете вообще не юзать else
endif;
```
Перед тем как копировать код, убедитесь, что у вас на сервере установлен memcache.
Надеюсь кому то пригодится решение.
